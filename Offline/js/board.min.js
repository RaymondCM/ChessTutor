function Init_Chessboard(){turnCount=0,fenHistory=[],drawScale(cb_counterScaleMarkings),SetTheme(cb_currentTheme),ct_debug||$("#Debug").css("display","none"),board="",game=new Chess;var a=function(e,a,r,t){return game.game_over()===!0||"w"===game.turn()&&-1!==a.search(/^b/)||"b"===game.turn()&&-1!==a.search(/^w/)||1===game_aiMode||game.turn()!==game_playerSide?!1:void 0},r=function(){$("#Chessboard .square-55d63").css("background",""),board.highlightSquare(cb_permHighlighted,!0)};highlightSquare=function(e,a){var r,t;a?(r=cb_currentTheme.permWhitePossiblePlaces,t=cb_currentTheme.permBlackPossiblePlaces):(r=cb_currentTheme.whitePossiblePlaces,t=cb_currentTheme.blackPossiblePlaces);var i=$("#Chessboard .square-"+e),n=i.hasClass("black-3c85d")===!0?t:r;i.css("background",n)};var t=function(e,a){var r=game.moves({square:e,verbose:!0});if(game.turn()===game_playerSide&&1!==game_aiMode&&0!==r.length){highlightSquare(e,!1);for(var t=0;t<r.length;t++)highlightSquare(r[t].to,!1)}},i=function(e,a){r()},n=function(){board.position(game.fen())},o={draggable:!0,position:"start",onDragStart:a,onDrop:MovePiece,onMouseoutSquare:i,onMouseoverSquare:t,onSnapEnd:n,pieceTheme:dir_pieceImages+"{piece}"+dir_pieceImagesExtension};board=ChessBoard("Chessboard",o),board.orientation("w"===game_playerSide?"white":"black"),turnCount++,updateStatus(),board.highlightSquare=function(e,a){for(x in e)highlightSquare(e[x],a)},board.highlightSquare(cb_permHighlighted,!0)}function MovePiece(e,a){2===game_aiMode&&(game_playerSide="w"===game_playerSide?"b":"w");var r=game.move({from:e,to:a,promotion:"q"});return null===r?"snapback":(board.position(game.fen()),turnCount++,void updateStatus())}function updateStatus(){checkForTaken(board.position()),updateDebugLog(),fenHistory.lengh<=cb_fenHistoryMaxLength?fenHistory.push(game.fen()):(fenHistory.shift(),fenHistory.push(game.fen())),AskEngine(game.fen(),sf_timeOverDepth?sf_searchTime:sf_searchDepth)}function piece(e){this.colourLetter=e.substr(0,1),this.nameletter=e.substr(1,2),this.colorWord="w"==e.substr(0,1)?"White":"Black",this.nameWord=pieces[e.substr(1,2)]}function updateScale(e){var a=document,r=sf_scoreWhite,t=sf_scoreBlack,i=[t,r],n=Math.min.apply(0,i),o=Math.max.apply(0,i);if(0!=n){var s=Math.pow(10,Math.floor(Math.log(Math.abs(n))/Math.LN10));n=Math.floor(n/s)*s}if(0!=o){var s=Math.pow(10,Math.floor(Math.log(Math.abs(o))/Math.LN10));o=Math.ceil(o/s)*s}a.getElementById("advLeft").innerHTML=n,a.getElementById("advMid").innerHTML=n+(o-n)/2,a.getElementById("advRight").innerHTML=o;var c=(r-n)/(o-n)*100,d=(t-n)/(o-n)*100;a.getElementById("advMarkerWhite").style.width=c+"%",a.getElementById("advMarkerBlack").style.width=d+"%",a.getElementById("advMarkerWhiteText").innerHTML=r,a.getElementById("advMarkerBlackText").innerHTML=t}function drawScale(e){for(var a=document,r=["advLower","advLowerMid","advUpperMid","advUpper"],t=a.createDocumentFragment(),i=0;i<r.length;i++){var n=a.createElement("div");n.className="advMarkers "+r[i]+" adv80",t.appendChild(n)}for(var o=t.childNodes,s=[],c=0;e>c;c++){s=[];for(var i=0;i<o.length;i++)for(var d=0;d<r.length;d++){var n=a.createElement("div");n.className="advMarkers "+r[d]+" adv55",o[i].appendChild(n),s.push(n)}o=s}a.getElementById("advScale").appendChild(t)}function checkForTaken(e){var a={wQ:0,wR:0,wB:0,wN:0,wP:0,wK:0,bQ:0,bR:0,bB:0,bN:0,bP:0,bK:0};for(var r in e)e.hasOwnProperty(r)&&a[e[r]]++;a.bP=8-a.bP,a.bR=2-a.bR,a.bN=2-a.bN,a.bB=2-a.bB,a.bQ=1-a.bQ,a.bK=1-a.bK,a.wP=8-a.wP,a.wR=2-a.wR,a.wN=2-a.wN,a.wB=2-a.wB,a.wQ=1-a.wQ,a.wK=1-a.wK;var t=a.wP+3*a.wB+3*a.wN+4*a.wR+9*a.wQ,i=a.bP+3*a.bB+3*a.bN+4*a.bR+9*a.bQ;relativeScore="w"==game_playerSide?i-t:t-i,updateScale();var n=document.getElementById(gui_blackCapturedId),o=document.getElementById(gui_whiteCapturedId);document.getElementById(gui_scoreBlackId).innerHTML="BLACK SCORE: "+t,document.getElementById(gui_scoreWhiteId).innerHTML="WHITE SCORE: "+i,document.getElementById(gui_scorePlayerId).innerHTML="YOUR "+("w"==game_playerSide?"(WHITE'S)":"(BLACK'S)")+" RELATIVE SCORE: "+relativeScore,n.innerHTML="CAPTURED BLACK PIECES: ",o.innerHTML="CAPTURED WHITE PIECES: ";for(var r in a)drawImg(dir_pieceImages+r+dir_pieceImagesExtension,"w"==r.charAt(0)?o:n,a[r])}function drawImg(e,a,r){var t=document.createElement("img");t.src=e,t.style.height=gui_capturedPieceSize,t.style.width=gui_capturedPieceSize;for(var i=0;r>i;i++)a.appendChild(t)}function updateDebugLog(){var e="",a="",r="",t="b"===game.turn()?"Black":"White";game.in_checkmate()===!0?r=t:game.in_draw()===!0?e="DRAW":(e=t,game.in_check()===!0&&(a=t)),$("#status").html("FEN: "+game.fen()+"<br><br>"),$("#fen").html("TURN: "+e),$("#check").html("COLOUR IN CHECK: "+a),$("#checkmate").html("COLOUR IN CHECKMATE: "+r)}function SetTheme(e){alterCSS(".square-55d63",cb_shapes[cb_currentTheme.boardShape]),cb_shapes[cb_currentTheme.boardShape]==cb_shapes.Diamond&&alterCSS(".square-55d63 img",cb_shapes.DiamondIMGFix),alterCSS(".white-1e1d7",e.whiteSquare,e.whiteSquareText),alterCSS(".black-3c85d",e.blackSquare,e.blackSquareText)}function alterCSS(e,a,r){var t="undefined"==typeof r||""===r?a:"background-color: "+a+"; color:"+r+";";$(e).removeProp?$(e).removeProp("background-color"):$(e).removeAttr("background-color");var i=$("#temp-css-store-c34jw2-f32r12");if(0==i.length){var i=$('<div id="temp-css-store-c34jw2-f32r12"></div>');i.hide(),i.appendTo($("body"))}classContainer=i.find('div[data-class="'+e+'"]'),0==classContainer.length&&(classContainer=$('<div data-class="'+e+'"></div>'),classContainer.appendTo(i)),classContainer.html("<style>"+e+" {"+t+"}</style>")}